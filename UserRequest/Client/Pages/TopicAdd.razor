@page "/topicAdd"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using UserRequest.Shared
@attribute [Authorize]
@inject HttpClient Http
@using System.Security.Claims
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

<div class="container">
    <h1>Faire une suggestion</h1>

    <EditForm Model="@topic" OnValidSubmit="@HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="form-group">
            <InputText placeholder="Titre" class="form-control" @bind-Value="topic.Title" />
        </div>
        <div class="form-group">
            <InputTextArea placeholder="Description complete" class="form-control" rows="5" @bind-Value="topic.Text" />
        </div>

        <button style="width:100%;margin-bottom:3rem" class="btn btn-outline-secondary" type="submit">Faire une suggestion</button>
    </EditForm>
</div>

@code {
    private Topic topic = new Topic();

    private void HandleValidSubmit()
    {
        // admintting it's valid.
        Http.PostAsJsonAsync<Topic>("api/Topic", topic).ContinueWith((r) =>
        {
            topic = r.Result.Content.ReadFromJsonAsync<Topic>().Result;
            NavigationManager.NavigateTo($"/TopicDetails/{topic.Id}");
        });
    }
}